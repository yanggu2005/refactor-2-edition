# Splitting the Phases of Calculation and Formatting

# 分离计算阶段与格式化阶段

到目前为止，我的重构主要是为原函数添加基本的结构，以便我更好地理解它，看清它的逻辑结构。重构的早期步骤一般都是这样。将复杂的代码块分解为更小的单元非常重要，与好的命名同等重要。现在，我可以更多关注我要修改的功能部分了——也即是为这张详单提供一个HTML版本。不管怎么说，现在改起来更加简单了。因为计算代码已经被分离出来，我只需要为顶部的七行代码实现一个HTML的版本。问题是，这些分解出来的函数嵌套在打印文本详单的函数里，我总不想将它们全复制粘贴到一个新的函数里，不管组织得有多好。我希望同样的计算函数可以被文本版详单和HTML版详单共用。

要实现复用有许多种方法，我最喜欢的技术是*Split Phrase*。这里我的目标是将逻辑分割成两部分：一部分计算详单所需的数据，另一部分将数据渲染成文本或HTML。第一阶段会创建一个中间数据结构，然后把它传递给第二阶段。


