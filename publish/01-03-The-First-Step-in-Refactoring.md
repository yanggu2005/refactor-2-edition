# 重构的第一步

每当我要进行重构的时猴，第一个步骤永远相同：确保即将修改的代码有一组可靠的测试。这些测试是必要的，因为尽管遵循重构手法可以使我避免绝大多数引入bug的情形，但我毕竟是人，毕竟有可能犯错。程序越大，我的修改不小心破坏其他代码的可能性就越大——在数字时代，软件啊你的名字就是脆弱。

【这段需要重翻】`statement`的返回值是个字符串，我做的就是创建几张新的发票，每张发票输入几个不同类型的戏剧，然后生成对应的`statement`字符串。生成的字符串，我会拿来与我已经手工检查过的字符串做比对。我会通过一个测试框架来配置好这些测试，这样我可以在开发环境中一键运行它们。运行测试只需要几秒，所以你会看到我经常跑测试。

测试过程中很重要的一部分，就是测试程序对于结果的报告方式。它们要么变绿，表示所有新字符串都和参考字符串一样，要么就变红，然后列出失败清单，显示问题字符串的出现行号。这些测试都能够自我检验。使测试能自我检验至关重要，否则就得耗费大把时间来回比对，这会降低我的开发速度。现代的测试框架都提供了足够的设施，支持你编写和运行能够自我检验的测试。

进行重构时，我需要依赖测试。我视测试为bug检测器，保护我不被自己的错误所困扰。把我想要的代码写两遍——实现一遍测试一遍——我就得犯两遍同样的错误才能骗过检测器。这降低了我做错事情的几率，因为我对工作进行了二次确认。尽管编写测试需要花费时间，但却为我节省下可观的调试时间。构筑测试体系对重构来说太重要了，因此我特意花费了一章笔墨来进行详细的讨论。

> 重构前，先检查自己是否有一套可靠的测试集。这些测试必须有自我检验能力。
